suite: deployment nfs volume test
templates:
  - common.yaml
tests:
  - it: should pass with default values
    documentIndex: &deploymentDoc 0
    asserts:
      - hasDocuments:
          count: 3
      - isKind:
          of: Deployment
      - isNull:
          path: spec.template.spec.volume

  - it: should pass with added nfs
    documentIndex: *deploymentDoc
    set:
      persistence:
        volume1:
          enabled: true
          type: nfs
          server: some.server.local
          path: /nfs/path
          noMount: true
    asserts:
      - contains:
          path: spec.template.spec.volumes
          content:
            name: volume1
            nfs:
              server: some.server.local
              path: /nfs/path

  - it: should fail with not set server on nfs
    set:
      persistence:
        some_volume:
          type: nfs
          enabled: true
          path: /some_path
          noMount: true
    asserts:
      - failedTemplate:
          errorMessage: NFS Server not set on item some_volume

  - it: should fail with path not starting with /
    set:
      persistence:
        some_volume:
          type: nfs
          enabled: true
          path: some/relative/path
          noMount: true
    asserts:
      - failedTemplate:
          errorMessage: NFS path (some/relative/path) on (some_volume) must start with a forward slash -> / <-

  - it: should fail with not set path on nfs
    set:
      persistence:
        some_volume:
          type: nfs
          enabled: true
          server: some_server
          noMount: true
    asserts:
      - failedTemplate:
          errorMessage: NFS Path not set on item some_volume
