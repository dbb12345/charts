
suite: service test hostNetwork
templates:
  - common.yaml
chart:
  appVersion: &appVer v1.2.3
tests:
  - it: should pass with default values
    documentIndex: &deploymentDoc 0
    asserts:
      - hasDocuments:
          count: 3
      - isKind:
          of: Deployment

  - it: should pass with correct apiVersion
    documentIndex: &serviceDoc 1
    asserts:
      - isKind:
          of: Service
      - isAPIVersion:
          of: v1

  - it: should pass with hostNetwork enabled
    documentIndex: *serviceDoc
    set:
      hostNetwork: true
      service:
        main:
          type: LoadBalancer
    asserts:
      - equal:
          path: spec
          value:
            type: ClusterIP
            ports: &defaultPort
              - name: main
                port: 65535
                protocol: TCP
                targetPort: main
            publishNotReadyAddresses: false
            selector: &defaultSelector
              app: common-test
              app.kubernetes.io/instance: RELEASE-NAME
              app.kubernetes.io/name: common-test
              release: RELEASE-NAME

  - it: should pass with hostPort defined, should be forced to ClusterIP
    documentIndex: *serviceDoc
    set:
      service:
        main:
          type: LoadBalancer
          ports:
            main:
              port: 65535
              hostPort: 12345
    asserts:
      - equal:
          path: spec
          value:
            type: ClusterIP
            ports: &defaultPort
              - name: main
                port: 65535
                protocol: TCP
                targetPort: main
            publishNotReadyAddresses: false
            selector: &defaultSelector
              app: common-test
              app.kubernetes.io/instance: RELEASE-NAME
              app.kubernetes.io/name: common-test
              release: RELEASE-NAME
