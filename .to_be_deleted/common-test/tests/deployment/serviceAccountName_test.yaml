
suite: deployment serviceAccountName
templates:
  - common.yaml
tests:
  - it: should pass with default values
    documentIndex: &deploymentDoc 0
    asserts:
      - hasDocuments:
          count: 3
      - isKind:
          of: Deployment

  - it: should pass (have correct serviceAccountName) with service account enabled
    documentIndex: &deploymentDoc 1
    set:
      serviceAccount:
        main:
          enabled: true
    asserts:
      - equal:
          path: spec.template.spec.serviceAccountName
          value: RELEASE-NAME-common-test

  - it: should pass (have correct serviceAccountName) with primary service account enabled and nameOverride defined
    documentIndex: *deploymentDoc
    set:
      serviceAccount:
        main:
          enabled: true
          nameOverride: some-name
    asserts:
      - equal:
          path: spec.template.spec.serviceAccountName
          value: RELEASE-NAME-common-test-some-name

  - it: should pass (have correct serviceAccountName) with non-primary service account enabled and nameOverride defined
    documentIndex: &deploymentDoc 2
    set:
      serviceAccount:
        main:
          enabled: true
          primary: true
        other:
          enabled: true
          primary: false
          nameOverride: some-name
    asserts:
      - equal:
          path: spec.template.spec.serviceAccountName
          value: RELEASE-NAME-common-test
