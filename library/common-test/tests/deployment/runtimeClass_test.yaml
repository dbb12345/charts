suite: deployment runtimeClassName test
templates:
  - common.yaml
tests:
  - it: should pass with default values
    documentIndex: &deploymentDoc 0
    asserts:
      - hasDocuments:
          count: 3
      - isKind:
          of: Deployment
      - isNull:
          path: spec.template.spec.runtimeClassName

  - it: should pass with addNvidiaRuntimeClass and nvidiaRuntimeClassName set
    documentIndex: *deploymentDoc
    set:
      scaleGPU:
        something: blabla
      global:
        ixChartContext:
          addNvidiaRuntimeClass: true
          nvidiaRuntimeClassName: something
    asserts:
      - equal:
          path: spec.template.spec.runtimeClassName
          value: something

  - it: should pass with addNvidiaRuntimeClass and nvidiaRuntimeClassName set and gpu on initContainers
    documentIndex: *deploymentDoc
    set:
      initContainers:
        some-name:
          scaleGPU:
            something: blabla
      global:
        ixChartContext:
          addNvidiaRuntimeClass: true
          nvidiaRuntimeClassName: something
    asserts:
      - equal:
          path: spec.template.spec.runtimeClassName
          value: something

  - it: should pass overriding global and per pod runtime
    documentIndex: *deploymentDoc
    set:
      controllers:
        main:
          pod:
            runtimeClassName: perpod
      scaleGPU:
        something: blabla
      globalDefaults:
        runtimeClassName: global
      global:
        ixChartContext:
          addNvidiaRuntimeClass: true
          nvidiaRuntimeClassName: something
    asserts:
      - equal:
          path: spec.template.spec.runtimeClassName
          value: something

  - it: should pass with nvidiaRuntimeClassName set but not addNvidiaRuntimeClassName
    documentIndex: *deploymentDoc
    set:
      global:
        ixChartContext:
          nvidiaRuntimeClassName: something
    asserts:
      - isNull:
          path: spec.template.spec.runtimeClassName

  - it: should pass with global runtime set
    documentIndex: *deploymentDoc
    set:
      globalDefaults:
        runtimeClassName: something
    asserts:
      - equal:
          path: spec.template.spec.runtimeClassName
          value: something

  - it: should pass with pod runtime set
    documentIndex: *deploymentDoc
    set:
      controllers:
        main:
          pod:
            runtimeClassName: something
    asserts:
      - equal:
          path: spec.template.spec.runtimeClassName
          value: something
